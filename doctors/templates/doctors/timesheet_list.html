{% extends 'base.html' %}

{% block content %}
<h1>لیست دفاتر و تایم‌شیت‌ها</h1>

{% for office in offices %}
    <div class="office-card">
        <h2>دفتر دکتر {{ office.doctor }}</h2>
        <p>مکان: {{ office.location }}</p>
        <p>شماره تماس: {{ office.phone_num }}</p>
        <p>قیمت ویزیت: {{ office.price }}</p>

        {% if user.is_authenticated %}
            {% if user.is_superuser or office.doctor.user == user %}
                <a href="{% url 'office_edit' office.id %}" class="btn btn-primary mb-2">ویرایش دفتر</a>
            {% endif %}
        {% endif %}

        <h3>تایم‌شیت‌ها</h3>
        <ul>
            {% for ts in office.time_sheets.all %}
                <li>
                    شروع: {{ ts.start }} - پایان: {{ ts.end }} (مدت: {{ ts.duration }} دقیقه)
                    {% if user.is_authenticated %}
                        {% if user.is_superuser or office.doctor.user == user %}
                            | <a href="{% url 'timesheet_edit' ts.id %}" class="btn btn-sm btn-secondary">ویرایش تایم‌شیت</a>
                        {% endif %}
                    {% endif %}
                </li>
            {% empty %}
                <li>تایم‌شیتی برای این دفتر ثبت نشده است.</li>
            {% endfor %}
        </ul>
    </div>
    <hr>
{% empty %}
    <p>هیچ دفتری ثبت نشده است.</p>
{% endfor %}

{% endblock %}
